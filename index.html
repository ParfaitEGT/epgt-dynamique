<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Service EPGT</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
	<h1 id="titre-accueil"></h1>
<h2 id="sous-titre-accueil"></h2>
<p id="texte-presentation"></p>
<a id="bouton-accueil" href="#services"></a>|
     <!-- <a href="/admin/">Admin</a> -->
    </nav>
  </header>

  <main>
    <section id="articles">
       <h2>Nos derniers articles</h2>
  <div id="article-list" class="articles-container"></div>
    </section>
  </main>

  <footer>
    <p>© 2025 - Service EPGT | Développé par Parfait Esaie</p>
  </footer>
    <script>
    if (window.location.hash.startsWith('#invite_token=')) {
      window.location.href = '/admin/' + window.location.hash;
    }
  </script>
  
<script>
  fetch('/articles')
    .then(res => res.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const links = [...doc.querySelectorAll('a')].filter(link => link.href.endsWith('.md'));

      const articleList = document.getElementById('article-list');

      links.forEach(link => {
        const filename = link.href.split('/').pop().replace('.md', '');
        fetch(`/articles/${filename}.md`)
          .then(res => res.text())
          .then(md => {
            const titleMatch = md.match(/title:\s*(.+)/);
            const dateMatch = md.match(/date:\s*(.+)/);
            const bodyMatch = md.match(/\n\n([\s\S]*)/);

            const title = titleMatch ? titleMatch[1] : 'Sans titre';
            const date = dateMatch ? new Date(dateMatch[1]).toLocaleDateString() : '';
            const excerpt = bodyMatch ? bodyMatch[1].substring(0, 100) + '...' : '';

            const articleEl = document.createElement('div');
            articleEl.className = 'article-card';
            articleEl.innerHTML = `
              <h3>${title}</h3>
              <p><em>${date}</em></p>
              <p>${excerpt}</p>
              <a href="articles/${filename}.md" target="_blank">Lire plus</a>
            `;
            articleList.appendChild(articleEl);
          });
      });
    });
</script>
<script>
  fetch('content/accueil.md')
    .then(response => response.text())
    .then(data => {
      const frontmatter = data.match(/---([\s\S]*?)---/)[1];
      const parsed = Object.fromEntries(
        frontmatter.trim().split('\n').map(line => {
          const [key, ...rest] = line.split(':');
          return [key.trim(), rest.join(':').trim()];
        })
      );

      document.getElementById('titre-accueil').textContent = parsed.titre;
      document.getElementById('sous-titre-accueil').textContent = parsed.sous_titre;
      document.getElementById('texte-presentation').textContent = parsed.presentation;
      document.getElementById('bouton-accueil').textContent = parsed.texte_bouton;
    });
</script>

</body>
</html>

